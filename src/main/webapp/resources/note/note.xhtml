<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:ui="http://java.sun.com/jsf/facelets"
xmlns:p="http://primefaces.org/ui"
xmlns:composite="http://java.sun.com/jsf/composite">


	
	<composite:interface>
		<composite:editableValueHolder  name="text" targets="inputarea"></composite:editableValueHolder>
		<composite:attribute name="interval" default="3000	" />
		<composite:attribute name="savingNotificationText" default="saving..." />
		<composite:attribute name="savedNotificationText" default="changes saved" />
	</composite:interface>
	
	
	<composite:implementation>
			<h:outputStylesheet library="css" name="ccnote.css"  />
			<h:outputScript library="javax.faces" name="jsf.js"/>
			
			<link href='http://fonts.googleapis.com/css?family=Fondamento' rel='stylesheet' type='text/css' />
			<link href='http://fonts.googleapis.com/css?family=Happy+Monkey' rel='stylesheet' type='text/css' />
			<link href='http://fonts.googleapis.com/css?family=Clicker+Script' rel='stylesheet' type='text/css' />
			<link href='http://fonts.googleapis.com/css?family=Noto+Serif' rel='stylesheet' type='text/css' />
			
			<script type="text/javascript">

				
				var timeout;
				if(!de) var de = {}
				if(!de.morton) de.morton = {
					saveNoteText : function(input, event) {
						var request = function() {
							jsf.ajax.request(input, event, {execute: "@this"});
							de.morton.showSavedText();
						}
						window.clearTimeout(timeout);
						timeout = window.setTimeout(request, ${cc.attrs.interval});
						de.morton.showSavingText();
					},
					
					showSavingText : function() {
						var el = jQuery("#statustext");
						el.text("${cc.attrs.savingNotificationText}");
						el.show();
					},
					
					showSavedText : function() {
						var el = jQuery("#statustext");
						el.text("${cc.attrs.savedNotificationText}");
						el.show().delay(1000).fadeOut();
					},
					
					chooseFont : function(name) {
						jQuery(".ccnote").css("font-family", "'"+name+"', cursive");
					},
					
					chooseFontSize : function(size) {
						jQuery(".ccnote").css("font-size",  size);
					}
				
				}
				
			</script>
			<div id="ccpanel" class="ccpanel" >
				<p:panel header="Note" showDetails="true" >
					<span id="statustext" ></span>
					<h:inputTextarea  onkeydown="de.morton.saveNoteText(this, event)"  id="inputarea" styleClass="ccnote"  value="#{cc.attrs.text}" style="width:100%;height:100%;"  />
					
					 	<f:facet name="options">
				            <p:menu>
				                <p:submenu label="Fonts">
				                    <p:menuitem value="Fondamento" onclick="de.morton.chooseFont('Fondamento')"/>
				                     <p:menuitem value="Happy Monkey" onclick="de.morton.chooseFont('Happy Monkey')"/>
				                     <p:menuitem value="Clicker Script" onclick="de.morton.chooseFont('Clicker Script')"/>
				                     <p:menuitem value="Noto Serif" onclick="de.morton.chooseFont('Noto Serif')"/>
				                </p:submenu>
				                <p:submenu label="Font size">
				                    <p:menuitem value="10" onclick="de.morton.chooseFontSize('10pt')"/>
				                    <p:menuitem value="14" onclick="de.morton.chooseFontSize('14pt')"/>
				                    <p:menuitem value="18" onclick="de.morton.chooseFontSize('18pt')"/>
				                    <p:menuitem value="22" onclick="de.morton.chooseFontSize('22pt')"/>
				                </p:submenu>
				            </p:menu>
				        </f:facet>
				</p:panel>
			</div>

	</composite:implementation>
</html>
